import{aw as V,ax as R,ay as Q,az as D,aA as K,R as l,aB as q,aC as k,aD as J,aE as Z,r as y,p as c,a4 as C,a as X,P as B,n as Y,j as p,d as a,aF as ee,B as te,u as A,ai as re,aG as ne,g as oe,i as ie,C as se,c as M}from"./index-41a412db.js";import{a as ae,V as le}from"./index.esm-e331af13.js";import{f as ce}from"./index-e0d45f5a.js";import{F as ue,p as pe}from"./Fab-cfe32548.js";import{R as fe,T as de}from"./TextFitler-02b10732.js";import{u as me}from"./useRemainingViewPortHeight-deac19eb.js";import"./index-33b41d47.js";import"./rotate-cw-8148c71c.js";import"./debounce-c1ba2006.js";var he=function(e){V(i,e);function i(r,t){var n;return n=e.call(this)||this,n.client=r,n.setOptions(t),n.bindMethods(),n.updateResult(),n}var o=i.prototype;return o.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},o.setOptions=function(t){this.options=this.client.defaultMutationOptions(t)},o.onUnsubscribe=function(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}},o.onMutationUpdate=function(t){this.updateResult();var n={listeners:!0};t.type==="success"?n.onSuccess=!0:t.type==="error"&&(n.onError=!0),this.notify(n)},o.getCurrentResult=function(){return this.currentResult},o.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},o.mutate=function(t,n){return this.mutateOptions=n,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,R({},this.options,{variables:typeof t<"u"?t:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},o.updateResult=function(){var t=this.currentMutation?this.currentMutation.state:Q(),n=R({},t,{isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=n},o.notify=function(t){var n=this;D.batch(function(){n.mutateOptions&&(t.onSuccess?(n.mutateOptions.onSuccess==null||n.mutateOptions.onSuccess(n.currentResult.data,n.currentResult.variables,n.currentResult.context),n.mutateOptions.onSettled==null||n.mutateOptions.onSettled(n.currentResult.data,null,n.currentResult.variables,n.currentResult.context)):t.onError&&(n.mutateOptions.onError==null||n.mutateOptions.onError(n.currentResult.error,n.currentResult.variables,n.currentResult.context),n.mutateOptions.onSettled==null||n.mutateOptions.onSettled(void 0,n.currentResult.error,n.currentResult.variables,n.currentResult.context))),t.listeners&&n.listeners.forEach(function(s){s(n.currentResult)})})},i}(K);function F(e,i,o){var r=l.useRef(!1),t=l.useState(0),n=t[1],s=q(e,i,o),h=k(),u=l.useRef();u.current?u.current.setOptions(s):u.current=new he(h,s);var d=u.current.getCurrentResult();l.useEffect(function(){r.current=!0;var b=u.current.subscribe(D.batchCalls(function(){r.current&&n(function(g){return g+1})}));return function(){r.current=!1,b()}},[]);var _=l.useCallback(function(b,g){u.current.mutate(b,g).catch(J)},[]);if(d.error&&Z(void 0,u.current.options.useErrorBoundary,[d.error]))throw d.error;return R({},d,{mutate:_,mutateAsync:d.mutate})}function O(){return O=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},O.apply(this,arguments)}function ve(e,i){if(e==null)return{};var o=ge(e,i),r,t;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)r=n[t],!(i.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function ge(e,i){if(e==null)return{};var o={},r=Object.keys(e),t,n;for(n=0;n<r.length;n++)t=r[n],!(i.indexOf(t)>=0)&&(o[t]=e[t]);return o}var N=y.forwardRef(function(e,i){var o=e.color,r=o===void 0?"currentColor":o,t=e.size,n=t===void 0?24:t,s=ve(e,["color","size"]);return l.createElement("svg",O({ref:i,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s),l.createElement("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),l.createElement("path",{d:"M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"}),l.createElement("path",{d:"M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"}))});N.propTypes={color:c.string,size:c.oneOfType([c.string,c.number])};N.displayName="Database";const be=N;function x(){return x=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},x.apply(this,arguments)}function ye(e,i){if(e==null)return{};var o=_e(e,i),r,t;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)r=n[t],!(i.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function _e(e,i){if(e==null)return{};var o={},r=Object.keys(e),t,n;for(n=0;n<r.length;n++)t=r[n],!(i.indexOf(t)>=0)&&(o[t]=e[t]);return o}var T=y.forwardRef(function(e,i){var o=e.color,r=o===void 0?"currentColor":o,t=e.size,n=t===void 0?24:t,s=ye(e,["color","size"]);return l.createElement("svg",x({ref:i,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s),l.createElement("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),l.createElement("polyline",{points:"14 2 14 8 20 8"}),l.createElement("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),l.createElement("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),l.createElement("polyline",{points:"10 9 9 9 8 9"}))});T.propTypes={color:c.string,size:c.oneOfType([c.string,c.number])};T.displayName="FileText";const we=T;function P(){return P=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},P.apply(this,arguments)}function Re(e,i){if(e==null)return{};var o=Oe(e,i),r,t;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)r=n[t],!(i.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Oe(e,i){if(e==null)return{};var o={},r=Object.keys(e),t,n;for(n=0;n<r.length;n++)t=r[n],!(i.indexOf(t)>=0)&&(o[t]=e[t]);return o}var $=y.forwardRef(function(e,i){var o=e.color,r=o===void 0?"currentColor":o,t=e.size,n=t===void 0?24:t,s=Re(e,["color","size"]);return l.createElement("svg",P({ref:i,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s),l.createElement("circle",{cx:"12",cy:"12",r:"10"}),l.createElement("line",{x1:"2",y1:"12",x2:"22",y2:"12"}),l.createElement("path",{d:"M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"}))});$.propTypes={color:c.string,size:c.oneOfType([c.string,c.number])};$.displayName="Globe";const xe=$;function j(){return j=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},j.apply(this,arguments)}function Pe(e,i){if(e==null)return{};var o=je(e,i),r,t;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)r=n[t],!(i.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function je(e,i){if(e==null)return{};var o={},r=Object.keys(e),t,n;for(n=0;n<r.length;n++)t=r[n],!(i.indexOf(t)>=0)&&(o[t]=e[t]);return o}var I=y.forwardRef(function(e,i){var o=e.color,r=o===void 0?"currentColor":o,t=e.size,n=t===void 0?24:t,s=Pe(e,["color","size"]);return l.createElement("svg",j({ref:i,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s),l.createElement("line",{x1:"4",y1:"9",x2:"20",y2:"9"}),l.createElement("line",{x1:"4",y1:"15",x2:"20",y2:"15"}),l.createElement("line",{x1:"10",y1:"3",x2:"8",y2:"21"}),l.createElement("line",{x1:"16",y1:"3",x2:"14",y2:"21"}))});I.propTypes={color:c.string,size:c.oneOfType([c.string,c.number])};I.displayName="Hash";const ze=I;function z(){return z=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},z.apply(this,arguments)}function Ee(e,i){if(e==null)return{};var o=ke(e,i),r,t;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)r=n[t],!(i.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function ke(e,i){if(e==null)return{};var o={},r=Object.keys(e),t,n;for(n=0;n<r.length;n++)t=r[n],!(i.indexOf(t)>=0)&&(o[t]=e[t]);return o}var S=y.forwardRef(function(e,i){var o=e.color,r=o===void 0?"currentColor":o,t=e.size,n=t===void 0?24:t,s=Ee(e,["color","size"]);return l.createElement("svg",z({ref:i,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s),l.createElement("polyline",{points:"23 4 23 10 17 10"}),l.createElement("polyline",{points:"1 20 1 14 7 14"}),l.createElement("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"}))});S.propTypes={color:c.string,size:c.oneOfType([c.string,c.number])};S.displayName="RefreshCw";const Ce=S;function E(){return E=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var o=arguments[i];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r])}return e},E.apply(this,arguments)}function Ne(e,i){if(e==null)return{};var o=Te(e,i),r,t;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(t=0;t<n.length;t++)r=n[t],!(i.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function Te(e,i){if(e==null)return{};var o={},r=Object.keys(e),t,n;for(n=0;n<r.length;n++)t=r[n],!(i.indexOf(t)>=0)&&(o[t]=e[t]);return o}var L=y.forwardRef(function(e,i){var o=e.color,r=o===void 0?"currentColor":o,t=e.size,n=t===void 0?24:t,s=Ne(e,["color","size"]);return l.createElement("svg",E({ref:i,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},s),l.createElement("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}))});L.propTypes={color:c.string,size:c.oneOfType([c.string,c.number])};L.displayName="Shield";const $e=L;function Ie(e){const i=e.providers,o=Object.keys(i),r={};for(let t=0;t<o.length;t++){const n=o[t];r[n]={...i[n],idx:t}}return{byName:r,names:o}}async function Se(e,i){const{url:o,init:r}=C(i);let t={providers:{}};try{const n=await fetch(o+e,r);n.ok&&(t=await n.json())}catch(n){console.log("failed to GET /providers/rules",n)}return Ie(t)}async function G({name:e,apiConfig:i}){const{url:o,init:r}=C(i);try{return(await fetch(o+`/providers/rules/${e}`,{method:"PUT",...r})).ok}catch(t){return console.log("failed to PUT /providers/rules/:name",t),!1}}async function Le({names:e,apiConfig:i}){for(let o=0;o<e.length;o++)await G({name:e[o],apiConfig:i})}var We=function(e,i,o,r,t,n,s,h){if(!e){var u;if(i===void 0)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var d=[o,r,t,n,s,h],_=0;u=new Error(i.replace(/%s/g,function(){return d[_++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}},Me=We;function De(e){return Me(e.rules&&e.rules.length>=0,"there is no valid rules list in the rules API response"),e.rules.map((i,o)=>({...i,id:o}))}async function Be(e,i){let o={rules:[]};try{const{url:r,init:t}=C(i),n=await fetch(r+e,t);n.ok&&(o=await n.json())}catch(r){console.log("failed to fetch rules",r)}return De(o)}const U=X({key:"ruleFilterText",default:""});function Ae(e,i){const o=k(),{mutate:r,isLoading:t}=F(G,{onSuccess:()=>{o.invalidateQueries("/providers/rules")}});return[s=>{s.preventDefault(),r({name:e,apiConfig:i})},t]}function Fe(e){const i=k(),{data:o}=H(e),{mutate:r,isLoading:t}=F(Le,{onSuccess:()=>{i.invalidateQueries("/providers/rules")}});return[s=>{s.preventDefault(),r({names:o.names,apiConfig:e})},t]}function H(e){return B(["/providers/rules",e],()=>Se("/providers/rules",e))}function Ge(e){const{data:i,isFetching:o}=B(["/rules",e],()=>Be("/rules",e)),{data:r}=H(e),[t]=Y(U);if(t==="")return{rules:i,provider:r,isFetching:o};{const n=t.toLowerCase();return{rules:i.filter(s=>s.payload.toLowerCase().indexOf(n)>=0),isFetching:o,provider:{byName:r.byName,names:r.names.filter(s=>s.toLowerCase().indexOf(n)>=0)}}}}const Ue="_RuleProviderItem_n6wmb_1",He="_refreshButton_n6wmb_11",Ve="_left_n6wmb_15",Qe="_middle_n6wmb_24",Ke="_nameRow_n6wmb_32",qe="_name_n6wmb_32",Je="_badgeGroup_n6wmb_45",Ze="_badge_n6wmb_45",Xe="_infoRow_n6wmb_63",Ye="_dot_n6wmb_71",et="_right_n6wmb_75",tt="_rotating_n6wmb_92",rt="_rotate_n6wmb_1",f={RuleProviderItem:Ue,refreshButton:He,left:Ve,middle:Qe,nameRow:Ke,name:qe,badgeGroup:Je,badge:Ze,infoRow:Xe,dot:Ye,right:et,rotating:tt,rotate:rt};function nt({idx:e,name:i,vehicleType:o,behavior:r,updatedAt:t,ruleCount:n,apiConfig:s}){const[h,u]=Ae(i,s),d=ce(new Date(t),new Date);return p("div",{className:f.RuleProviderItem,children:[a("div",{className:f.left,children:e}),p("div",{className:f.middle,children:[p("div",{className:f.nameRow,children:[a("span",{className:f.name,children:i}),p("div",{className:f.badgeGroup,children:[p("span",{className:f.badge,children:[a(be,{size:12}),o]}),p("span",{className:f.badge,children:[a(ee,{size:12}),r]})]})]}),p("div",{className:f.infoRow,children:[p("span",{className:f.count,children:[n," rules"]}),a("span",{className:f.dot,children:"â€¢"}),p("span",{className:f.time,children:["Updated ",d," ago"]})]})]}),a("div",{className:f.right,children:a(te,{kind:"minimal",onClick:h,disabled:u,className:f.refreshButton,children:a(Ce,{size:18,className:u?f.rotating:""})})})]})}function ot({apiConfig:e}){const[i,o]=Fe(e),{t:r}=A();return a(ue,{icon:a(fe,{isRotating:o}),text:r("update_all_rule_provider"),style:pe,onClick:i})}const it="_rule_24pro_4",st="_left_24pro_15",at="_right_24pro_24",lt="_payloadRow_24pro_30",ct="_payload_24pro_30",ut="_size_24pro_44",pt="_metaRow_24pro_55",ft="_typeTag_24pro_62",dt="_proxyTag_24pro_77",v={rule:it,left:st,right:at,payloadRow:lt,payload:ct,size:ut,metaRow:pt,typeTag:ft,proxyTag:dt},w={_default:"var(--color-focus-blue)",DIRECT:"#f5bc41",REJECT:"#cb3166"};function mt({proxy:e}){let i=w._default;return w[e]&&(i=w[e]),{color:i}}function ht(e){switch(e){case"Domain":case"DomainSuffix":case"DomainKeyword":return a(ne,{size:14});case"IPCIDR":case"IPCIDR6":return a(ze,{size:14});case"GeoSite":case"GeoIP":return a(xe,{size:14});case"REJECT":return a($e,{size:14});case"DIRECT":return a(re,{size:14});default:return a(we,{size:14})}}function vt({type:e,payload:i,proxy:o,id:r,size:t}){const n=mt({proxy:o});return p("div",{className:v.rule,children:[a("div",{className:v.left,children:r}),p("div",{className:v.right,children:[p("div",{className:v.payloadRow,children:[a("div",{className:v.payload,children:i}),(e==="GeoSite"||e==="GeoIP")&&p("div",{className:v.size,children:["size: ",t]})]}),p("div",{className:v.metaRow,children:[p("div",{className:v.typeTag,children:[ht(e),a("span",{children:e})]}),a("div",{className:v.proxyTag,style:n,children:o})]})]})]})}const gt="_container_1popp_4",bt="_filterWrapper_1popp_10",yt="_listWrapper_1popp_21",_t="_RuleProviderItemWrapper_1popp_34",wt="_tabsContainer_1popp_38",Rt="_tab_1popp_38",Ot="_active_1popp_75",xt="_tabCount_1popp_81",m={container:gt,filterWrapper:bt,listWrapper:yt,RuleProviderItemWrapper:_t,tabsContainer:wt,tab:Rt,active:Ot,tabCount:xt},{memo:Pt,useState:jt,useCallback:zt}=l;function Et(e,{rules:i,provider:o}){return i?i[e].id:o.names[e]}function kt({isRulesTab:e}){return function(){return e?70:100}}const Ct=Pt(({index:e,style:i,data:o})=>{const{rules:r,provider:t,apiConfig:n}=o;if(!r){const h=t.names[e],u=t.byName[h];return a("div",{style:i,className:m.RuleProviderItemWrapper,children:a(nt,{apiConfig:n,...u})})}const s=r[e];return a("div",{style:i,children:a(vt,{...s})})},ae),Nt=e=>({apiConfig:ie(e)}),Ft=oe(Nt)(Tt);function Tt({apiConfig:e}){const[i,o]=me(),{rules:r,provider:t}=Ge(e),[n,s]=jt("rules"),h=g=>g<100?""+g:"99+",u=zt(g=>W=>{(W.key==="Enter"||W.key===" ")&&s(g)},[]),d=n==="rules",_=kt({isRulesTab:d}),{t:b}=A();return p("div",{className:m.container,children:[p(se,{children:[p("div",{className:m.tabsContainer,children:[p("div",{className:M(m.tab,{[m.active]:n==="rules"}),onClick:()=>s("rules"),onKeyDown:u("rules"),role:"button",tabIndex:0,children:[b("Rules"),a("span",{className:m.tabCount,children:h(r.length)})]}),t.names.length>0&&p("div",{className:M(m.tab,{[m.active]:n==="providers"}),onClick:()=>s("providers"),onKeyDown:u("providers"),role:"button",tabIndex:0,children:[b("rule_provider"),a("span",{className:m.tabCount,children:h(t.names.length)})]})]}),a("div",{style:{flex:1}}),a("div",{className:m.filterWrapper,children:a(de,{textAtom:U,placeholder:b("Search")})})]}),a("div",{ref:i,className:m.listWrapper,children:a(le,{height:o,width:"100%",itemCount:d?r.length:t.names.length,itemSize:_,itemData:{rules:d?r:null,provider:t,apiConfig:e},itemKey:Et,children:Ct})}),t&&t.names&&t.names.length>0?a(ot,{apiConfig:e}):null]})}export{Ft as default};
