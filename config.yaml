# mihomo é…ç½® - UDM-SE é€æ˜ä»£ç†
# æ–‡æ¡£: https://wiki.metacubex.one/

# åŸºæœ¬è®¾ç½®
mixed-port: 7890
tproxy-port: 7893
allow-lan: true
bind-address: "*"
mode: rule
log-level: info
ipv6: false
external-controller: 0.0.0.0:9090
# external-ui: /data/mihomo/ui  # å¯é€‰: ä¸‹è½½ yacd é¢æ¿

# DNS è®¾ç½®
dns:
  enable: true
  listen: 0.0.0.0:53
  ipv6: false
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "*.hen-ladon.ts.net"
    - "localhost.ptlogin2.qq.com"
    - "+.msftconnecttest.com"
    - "+.msftncsi.com"
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  nameserver-policy:
    # Tailscale åŸŸåèµ° MagicDNS
    "+.hen-ladon.ts.net": "100.100.100.100"
    # å›½å†…åŸŸåèµ°å›½å†… DNS
    "geosite:cn,private":
      - https://doh.pub/dns-query
      - https://dns.alidns.com/dns-query

# TUN æ¨¡å¼ (å¤‡é€‰ï¼Œå¦‚æœ TProxy æœ‰é—®é¢˜å¯ä»¥åˆ‡æ¢)
# tun:
#   enable: true
#   stack: system
#   dns-hijack:
#     - any:53
#   auto-route: true
#   auto-detect-interface: true

# è®¢é˜…ä»£ç†
proxy-providers:
  my-sub:
    type: http
    url: "YOUR_CLASH_SUBSCRIPTION_URL_HERE"
    interval: 3600
    path: ./providers/my-sub.yaml
    health-check:
      enable: true
      interval: 300
      url: https://www.gstatic.com/generate_204

# ä»£ç†ç»„
proxy-groups:
  - name: "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
    type: select
    use:
      - my-sub
    proxies:
      - "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
      - DIRECT

  - name: "â™»ï¸ è‡ªåŠ¨é€‰æ‹©"
    type: url-test
    use:
      - my-sub
    url: https://www.gstatic.com/generate_204
    interval: 300
    tolerance: 50

  - name: "ğŸ¬ æµåª’ä½“"
    type: select
    use:
      - my-sub
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  - name: "ğŸ¤– AI æœåŠ¡"
    type: select
    use:
      - my-sub
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"

  - name: "ğŸŸ æ¼ç½‘ä¹‹é±¼"
    type: select
    proxies:
      - "ğŸš€ èŠ‚ç‚¹é€‰æ‹©"
      - DIRECT

# åˆ†æµè§„åˆ™
rules:
  # ç§æœ‰åœ°å€ç›´è¿
  - IP-CIDR,192.168.0.0/16,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,172.16.0.0/12,DIRECT
  - IP-CIDR,127.0.0.0/8,DIRECT
  - IP-CIDR,100.64.0.0/10,DIRECT  # Tailscale CGNAT

  # AI æœåŠ¡
  - DOMAIN-SUFFIX,openai.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,anthropic.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,claude.ai,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,bard.google.com,ğŸ¤– AI æœåŠ¡
  - DOMAIN-SUFFIX,gemini.google.com,ğŸ¤– AI æœåŠ¡

  # æµåª’ä½“
  - GEOSITE,netflix,ğŸ¬ æµåª’ä½“
  - GEOSITE,disney,ğŸ¬ æµåª’ä½“
  - GEOSITE,youtube,ğŸ¬ æµåª’ä½“

  # å›½å†…ç›´è¿
  - GEOSITE,cn,DIRECT
  - GEOIP,CN,DIRECT

  # å…œåº•
  - MATCH,ğŸŸ æ¼ç½‘ä¹‹é±¼
